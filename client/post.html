<html>

<head>
  <meta charset="UTF-8">
  <title>Negociações</title>
  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="stylesheet" href="css/bootstrap-theme.css">
  <link rel="stylesheet" href="css/mystyle.css">
</head>

<body class="container">
  <h1 class="text-center">Enviar Negociações ao Server</h1>
  <form class="form">

    <div class="form-group">
      <label for="data">Data</label>
      <input type="date" id="data" class="form-control" required autofocus />
    </div>

    <div class="form-group">
      <label for="quantidade">Quantidade</label>
      <input type="number" min="1" step="1" id="quantidade" class="form-control" value="1" required />
    </div>

    <div class="form-group">
      <label for="valor">Valor</label>
      <input id="valor" type="number" class="form-control" min="0.01" step="0.01" value="0.0" required />
    </div>

    <button class="btn btn-primary" type="submit" onclick="sendPost(event)">Enviar dados para servidor</button>
  </form>
  <script src="js/app/models/Negociacao.js"></script>
  <script src="js/app/controllers/NegociacaoController.js"></script>
  <script src="js/app/helpers/DateConverter.js"></script>
  <script src="js/app/models/ListaNegociacoes.js"></script>
  <script src="js/app/views/View.js"></script>
  <script src="js/app/views/NegociacoesView.js"></script>
  <script src="js/app/models/Mensagem.js"></script>
  <script src="js/app/views/MensagemView.js"></script>
  <script src="js/app/services/ProxyFactory.js"></script>
  <script src="js/app/helpers/Bind.js"></script>
  <script src="js/app/services/HttpService.js"></script>
  <script src="js/app/services/NegociacaoService.js"></script>
  <script>

    function sendPost(event) {

      event.preventDefault();
      console.log("Enviando post");

      let $ = document.querySelector.bind(document);
      this._inputData = $('#data');
      this._inputQuantidade = $('#quantidade');
      this._inputValor = $('#valor');
      
      // let adicionar1 = function(data) {
      //   data.split('-').forEach((item, index) => {
      //     if(item[1] == "2019" && item[2] > "10") {
      //       return item[3] + 1;
      //       console.log(item[3])
      //     } else if(item[1] > "2019") {
      //       return item[3] + 1;
      //     }
      //   }).join('-');
      // };
      // let dataTeste = adicionar1(_inputData.value);
      let negociacao = {
        data: _inputData.value,
        quantidade: _inputQuantidade.value,
        valor: _inputValor.value
      };
      
      new HttpService().post('/negociacoes', negociacao)
      .then(() => {
        this._inputData.value = '';
        this._inputQuantidade.value = 1;
        this._inputValor.value = 0.0;
        this._inputData.focus();
        alert('Negociação enviada com sucesso!');
      })
      .catch(error => alert(`Não foi possível enviar a negociação ao servidor: ${error}`));
      console.log(negociacao);
    }
  </script>
</body>

</html>